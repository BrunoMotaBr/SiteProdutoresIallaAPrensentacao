<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mensagens - Ialla - Produtores</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <header class="cabecalho">
        <script src="../main.js"></script>
        <script src="../componente/cabecalho.render.js"></script>
        <script>
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            console.log(id)
            renderCabecalho(".cabecalho", id);
        </script>
    </header>

    <main>
        <section class="conteudo caixa-mensagens-mensagens">
            <section class="caixa-mensagens">
                <input type="text" name="" id="" placeholder="Pesquisar">
                <!--
                    <Todo> Puxar historico de conversas
                -->
            </section>
            <section class="caixa-mensagens mensagens">
                <!--
                    <Todo> Puxar historico da conversa selecionada
                -->
                <div class="chat-input" role="group" aria-label="Enviar mensagem">
                    <input id="campo-mensagem" class="chat-input__field" type="text" placeholder="Mensagem..." />          
                    <div class="botoes-mensagens">
                        <button class="chat-input__btn" type="button" id="btn-anexo">
                            <img src="../icons/clip.png" alt="" srcset="">
                        </button>
                        <button class="chat-input__btn" type="button" id="btn-microfone">
                            <img src="../icons/audio.png" alt="" srcset="">
                        </button>
                    </div>
                </div>
            </section>
        </section>
    </main>

    <script>
        const campo = document.getElementById('campo-mensagem');
        campo.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' && !ev.shiftKey) {
            ev.preventDefault();
            handleEnviarMensagem();
        }
        });


            document.getElementById('btn-microfone').addEventListener('click', () => {
            // TODO: iniciar/parar captura de áudio aqui (usar MediaRecorder)
            console.log('[TODO] Clique no microfone — implementar gravação de áudio');
            flashBotao('btn-microfone');
        });


        document.getElementById('btn-anexo').addEventListener('click', () => {
        // TODO: abrir seletor de arquivos e anexar ao draft da mensagem
        console.log('[TODO] Clique no clipe — implementar anexos de arquivo');
        flashBotao('btn-anexo');
        });


        function handleEnviarMensagem() {
        const texto = (campo.value || '').trim();
        if (!texto) return;


        // TODO: enviar mensagem para o backend
        // Ex.: fetch('/api/mensagens', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ texto }) })
        console.log('[TODO] Enviar mensagem:', texto);
            campo.value = '';
            campo.focus();
        }


        function flashBotao(id) {
            const el = document.getElementById(id);
            el.animate([{ transform: 'scale(1)' }, { transform: 'scale(0.9)' }, { transform: 'scale(1)' }], { duration: 140 });
        }
    </script>
    <script src="../main.js"></script>
</body>
</html>